{% extends "admin/change_form.html" %}
{% load i18n admin_modify adminmedia %}

{% block extrahead %}{{ block.super }}

<link type="text/css" href="{{ STATIC_URL }}feincms/jquery-ui/jquery-ui-1.8.16.custom.css" rel="Stylesheet" />

{% block feincms_jquery_ui %}
<script type="text/javascript" src="{{ STATIC_URL }}feincms/jquery-1.7.min.js"></script>
<script type="text/javascript" src="{{ STATIC_URL }}feincms/jquery-ui-1.8.16.custom.min.js"></script>
{% endblock %}

<link rel="stylesheet" type="text/css" href="{{ STATIC_URL }}feincms/style.css" />

<script type="text/javascript" src="{{ STATIC_URL }}feincms/jquery.alerts.js"></script>
<script type="text/javascript">
    var feincms = {
        {% if FEINCMS_JQUERY_NO_CONFLICT %}
        "jQuery": jQuery.noConflict(true)
        {% else %}
        "jQuery": jQuery
        {% endif %}
    };
</script>
<script type="text/javascript" src="{{ STATIC_URL }}feincms/item_editor.js"></script>

{% include "admin/feincms/_messages_js.html" %}
{% include "admin/feincms/_regions_js.html" %}
{% include "admin/feincms/_content_type_buttons.html" %}

{% for inc in model.feincms_item_editor_includes.head %}{% include inc %}{% endfor %}

<script type="text/javascript">
    feincms.jQuery(document).ready(function($){
        {% block extra-init-js %}{# /* do not use this block, use feincms_item_editor_includes instead */ #}{% endblock %}
    });
</script>
{% endblock %}

{% block form_top %}
  {% with original.available_translations as translations %}
    {% if translations %}
      <div style="float: right;padding: 5px 0 0 0" id="available_translations">
        {% trans "available translations" %}:
        {% for translation in translations %}
          <a href="../{{ translation.id }}/" title="{{ translation }}">{{ translation.language|upper }}</a>{% if not forloop.last %},{% endif %}
        {% endfor %}
      </div>
      <script type="text/javascript">
        feincms.jQuery(function($){
            $('#id_language').parent().prepend($('#available_translations'));
        });
      </script>
    {% endif %}
  {% endwith %}
{% endblock %}

{% block after_related_objects %} {# as good a place as any... #}
  {{ block.super }}

  <div id="content-editor-fieldset" style="display: none">
    {% include "admin/feincms/content_editor.html" %}
  </div>

<script type="text/javascript">
/* begin options as tabs, as early as possible to avoid flashing
   (so inline, not in document.ready) */

var tab_fields = $('fieldset.feincms-collapse');
var ul = $('<ul></ul>');

/* This is a work-around for inline js in those fields, especially
   TagSelectFields, it would run twice. Hopefully this won't cause
   problems elsewhere */
$('script', tab_fields).remove();

/* Convert fieldsets>h2 into structure expected by jquery-ui tabs */
tab_fields.each(function(i, c) {
    var tab_id = c.id = 'tabs-' + i;
    var h2 = $('h2', c).remove().text();
    ul.append('<li class="navi_tab"><a href="#' + tab_id + '">' + h2 + '</a></li>');
});

/* If any tabs throws errors, select that immediately */
$("h2:contains('{{ FEINCMS_CONTENT_FIELDSET_NAME }}')").parent().before(
    $('<div id="tabs"></div>')
    .append(ul)
    .append(tab_fields));

$('#tabs').tabs({ collapsible: true, selected: -1 });

if(d = $('ul.errorlist:first', tab_fields)
    .parents('fieldset')
    .attr('id')) {
    $('#tabs').tabs('select', d);
}

/* place for main region tabs */
$("h2:contains('{{ FEINCMS_CONTENT_FIELDSET_NAME }}')").parent().replaceWith($("#main_wrapper"));

/* Style stuff rounder */
$(function() {
    $('fieldset,.submit-row,input').addClass('ui-corner-all');
    $('.navi_tab').addClass('ui-corner-top');
    $('.machine-control').addClass('ui-corner-bottom');

});

</script>

{% endblock %}
